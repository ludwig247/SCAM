<?xml version="1.0" ?>
<Module name="Example">
    <Datatypes>
        <Example_SECTIONS type="enum">
            <frame_data />
            <frame_start />
            <idle />
        </Example_SECTIONS>
        <bool type="built-in" />
        <int type="built-in" />
        <msg_t type="compound">
            <subvar name="data" type="int" />
            <subvar name="status" type="status_t" />
        </msg_t>
        <status_t type="enum">
            <in_frame />
            <oof_frame />
        </status_t>
        <unsigned type="built-in" />
    </Datatypes>
    <Ports>
        <port name="b_in" interface="blocking" direction="in" datatype="msg_t" />
        <port name="m_out" interface="master" direction="out" datatype="int" />
        <port name="s_out" interface="shared" direction="out" datatype="bool" />
    </Ports>
    <Variables>
        <variable name="cnt" datatype="int" init="0" />
        <variable name="msg" datatype="msg_t" />
        <variable name="ready" datatype="bool" init="false" />
    </Variables>
    <CFG>
        <Section name="frame_data">
            <assignment>
                <lhs>
                    <VariableOperand variable="ready" />
                </lhs>
                <rhs>
                    <nb_read port="b_in" variable="msg" />
                </rhs>
            </assignment>
            <ITE>
                <condition>
                    <unary operation="not">
                        <VariableOperand variable="ready" />
                    </unary>
                </condition>
                <IF>
                    <write port="m_out">
                        <VariableOperand variable="msg" subvariable="data" />
                    </write>
                    <ITE>
                        <condition>
                            <relational operation="==">
                                <lhs>
                                    <VariableOperand variable="cnt" />
                                </lhs>
                                <rhs>
                                    <IntegerValue value="0" />
                                </rhs>
                            </relational>
                        </condition>
                        <IF>
                            <assignment>
                                <lhs>
                                    <SectionOperand value="section" />
                                </lhs>
                                <rhs>
                                    <SectionValue value="idle" />
                                </rhs>
                            </assignment>
                        </IF>
                    </ITE>
                    <assignment>
                        <lhs>
                            <VariableOperand variable="cnt" />
                        </lhs>
                        <rhs>
                            <arithmetic operation="-">
                                <lhs>
                                    <VariableOperand variable="cnt" />
                                </lhs>
                                <rhs>
                                    <IntegerValue value="1" />
                                </rhs>
                            </arithmetic>
                        </rhs>
                    </assignment>
                </IF>
            </ITE>
        </Section>
        <Section name="frame_start">
            <write port="m_out">
                <VariableOperand variable="cnt" />
            </write>
            <assignment>
                <lhs>
                    <VariableOperand variable="cnt" />
                </lhs>
                <rhs>
                    <arithmetic operation="-">
                        <lhs>
                            <VariableOperand variable="cnt" />
                        </lhs>
                        <rhs>
                            <IntegerValue value="1" />
                        </rhs>
                    </arithmetic>
                </rhs>
            </assignment>
            <ITE>
                <condition>
                    <relational operation="==">
                        <lhs>
                            <VariableOperand variable="cnt" />
                        </lhs>
                        <rhs>
                            <IntegerValue value="0" />
                        </rhs>
                    </relational>
                </condition>
                <IF>
                    <assignment>
                        <lhs>
                            <VariableOperand variable="cnt" />
                        </lhs>
                        <rhs>
                            <IntegerValue value="15" />
                        </rhs>
                    </assignment>
                    <assignment>
                        <lhs>
                            <SectionOperand value="section" />
                        </lhs>
                        <rhs>
                            <SectionValue value="frame_data" />
                        </rhs>
                    </assignment>
                </IF>
            </ITE>
        </Section>
        <Section name="idle">
            <nb_write port="s_out">
                <BoolValue value="false" />
            </nb_write>
            <read port="b_in" variable="msg" />
            <ITE>
                <condition>
                    <relational operation="==">
                        <lhs>
                            <VariableOperand variable="msg" subvariable="status" />
                        </lhs>
                        <rhs>
                            <BoolValue value="in_frame" />
                        </rhs>
                    </relational>
                </condition>
                <IF>
                    <nb_write port="s_out">
                        <BoolValue value="true" />
                    </nb_write>
                    <assignment>
                        <lhs>
                            <SectionOperand value="section" />
                        </lhs>
                        <rhs>
                            <SectionValue value="frame_start" />
                        </rhs>
                    </assignment>
                    <assignment>
                        <lhs>
                            <VariableOperand variable="cnt" />
                        </lhs>
                        <rhs>
                            <IntegerValue value="3" />
                        </rhs>
                    </assignment>
                </IF>
            </ITE>
        </Section>
        <Section name="init">
            <assignment>
                <lhs>
                    <SectionOperand value="section" />
                </lhs>
                <rhs>
                    <SectionValue value="idle" />
                </rhs>
            </assignment>
            <assignment>
                <lhs>
                    <VariableOperand variable="cnt" />
                </lhs>
                <rhs>
                    <IntegerValue value="0" />
                </rhs>
            </assignment>
            <assignment>
                <lhs>
                    <VariableOperand variable="msg" subvariable="data" />
                </lhs>
                <rhs>
                    <IntegerValue value="0" />
                </rhs>
            </assignment>
            <assignment>
                <lhs>
                    <VariableOperand variable="msg" subvariable="status" />
                </lhs>
                <rhs>
                    <BoolValue value="in_frame" />
                </rhs>
            </assignment>
            <assignment>
                <lhs>
                    <VariableOperand variable="ready" />
                </lhs>
                <rhs>
                    <BoolValue value="false" />
                </rhs>
            </assignment>
            <nb_write port="s_out">
                <BoolValue value="false" />
            </nb_write>
        </Section>
    </CFG>
    <PPA>
        <States>
            <state state_id="-1" name="init" section="init" />
            <state state_id="0" name="frame_data_0" section="frame_data">
                <ports>
                    <b_in />
                </ports>
            </state>
            <state state_id="2" name="frame_start_2" section="frame_start">
                <ports>
                    <m_out />
                </ports>
            </state>
            <state state_id="3" name="idle_3" section="idle">
                <ports>
                    <b_in />
                </ports>
            </state>
        </States>
        <Operations>
            <operation id="10" name="reset" fromState="-1" toState="3">
                <assumptions />
                <commitments />
            </operation>
            <operation id="11" name="frame_data_0" fromState="0" toState="0">
                <assumptions>
                    <syncSignal port="b_in" />
                    <syncSignal port="b_in" />
                </assumptions>
                <commitments>
                    <syncSignal port="b_in" />
                    <syncSignal port="b_in" />
                </commitments>
            </operation>
            <operation id="20" name="frame_data_1" fromState="0" toState="0">
                <assumptions>
                    <unary operation="not">
                        <relational operation="==">
                            <lhs>
                                <VariableOperand variable="cnt" />
                            </lhs>
                            <rhs>
                                <IntegerValue value="0" />
                            </rhs>
                        </relational>
                    </unary>
                    <unary operation="not">
                        <syncSignal port="b_in" />
                    </unary>
                </assumptions>
                <commitments>
                    <unary operation="not">
                        <relational operation="==">
                            <lhs>
                                <VariableOperand variable="cnt" />
                            </lhs>
                            <rhs>
                                <IntegerValue value="0" />
                            </rhs>
                        </relational>
                    </unary>
                    <unary operation="not">
                        <syncSignal port="b_in" />
                    </unary>
                </commitments>
            </operation>
            <operation id="21" name="frame_data_2" fromState="0" toState="3">
                <assumptions>
                    <relational operation="==">
                        <lhs>
                            <VariableOperand variable="cnt" />
                        </lhs>
                        <rhs>
                            <IntegerValue value="0" />
                        </rhs>
                    </relational>
                    <unary operation="not">
                        <syncSignal port="b_in" />
                    </unary>
                </assumptions>
                <commitments>
                    <relational operation="==">
                        <lhs>
                            <VariableOperand variable="cnt" />
                        </lhs>
                        <rhs>
                            <IntegerValue value="0" />
                        </rhs>
                    </relational>
                    <unary operation="not">
                        <syncSignal port="b_in" />
                    </unary>
                </commitments>
            </operation>
            <operation id="15" name="frame_start_3" fromState="2" toState="0">
                <assumptions>
                    <relational operation="==">
                        <lhs>
                            <VariableOperand variable="cnt" />
                        </lhs>
                        <rhs>
                            <IntegerValue value="1" />
                        </rhs>
                    </relational>
                </assumptions>
                <commitments>
                    <relational operation="==">
                        <lhs>
                            <VariableOperand variable="cnt" />
                        </lhs>
                        <rhs>
                            <IntegerValue value="1" />
                        </rhs>
                    </relational>
                </commitments>
            </operation>
            <operation id="16" name="frame_start_4" fromState="2" toState="2">
                <assumptions>
                    <unary operation="not">
                        <relational operation="==">
                            <lhs>
                                <VariableOperand variable="cnt" />
                            </lhs>
                            <rhs>
                                <IntegerValue value="1" />
                            </rhs>
                        </relational>
                    </unary>
                </assumptions>
                <commitments>
                    <unary operation="not">
                        <relational operation="==">
                            <lhs>
                                <VariableOperand variable="cnt" />
                            </lhs>
                            <rhs>
                                <IntegerValue value="1" />
                            </rhs>
                        </relational>
                    </unary>
                </commitments>
            </operation>
            <operation id="17" name="idle_5" fromState="3" toState="2">
                <assumptions>
                    <relational operation="==">
                        <lhs>
                            <dataSignal port="b_in" subsig="status" />
                        </lhs>
                        <rhs>
                            <BoolValue value="in_frame" />
                        </rhs>
                    </relational>
                    <syncSignal port="b_in" />
                </assumptions>
                <commitments>
                    <relational operation="==">
                        <lhs>
                            <dataSignal port="b_in" subsig="status" />
                        </lhs>
                        <rhs>
                            <BoolValue value="in_frame" />
                        </rhs>
                    </relational>
                    <syncSignal port="b_in" />
                </commitments>
            </operation>
            <operation id="18" name="idle_6" fromState="3" toState="3">
                <assumptions>
                    <unary operation="not">
                        <syncSignal port="b_in" />
                    </unary>
                </assumptions>
                <commitments>
                    <unary operation="not">
                        <syncSignal port="b_in" />
                    </unary>
                </commitments>
            </operation>
            <operation id="19" name="idle_7" fromState="3" toState="3">
                <assumptions>
                    <unary operation="not">
                        <relational operation="==">
                            <lhs>
                                <dataSignal port="b_in" subsig="status" />
                            </lhs>
                            <rhs>
                                <BoolValue value="in_frame" />
                            </rhs>
                        </relational>
                    </unary>
                    <syncSignal port="b_in" />
                </assumptions>
                <commitments>
                    <unary operation="not">
                        <relational operation="==">
                            <lhs>
                                <dataSignal port="b_in" subsig="status" />
                            </lhs>
                            <rhs>
                                <BoolValue value="in_frame" />
                            </rhs>
                        </relational>
                    </unary>
                    <syncSignal port="b_in" />
                </commitments>
            </operation>
        </Operations>
    </PPA>
</Module>